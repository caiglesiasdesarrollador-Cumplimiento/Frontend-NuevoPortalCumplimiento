<!-- ✅ Controles de la tabla -->
<div class="flex justify-between items-center mb-4">
  <div class="flex items-center space-x-2">
    <span class="lib-tb-body-small text-grayscaleD200">
      {{ coberturasTable.value?.length || 0 }} elementos encontrados
    </span>
  </div>
  <div class="flex items-center space-x-2">
    <button class="lib-tb-button-secondary px-3 py-1 text-sm" (click)="onClearSelection()">
      <i class="fa-solid fa-times mr-1"></i>
      Limpiar Selección
    </button>
    <button class="lib-tb-button-primary px-3 py-1 text-sm" (click)="onRefreshCoberturas()">
      <i class="fa-solid fa-sync-alt mr-1"></i>
      Actualizar
    </button>
    <button
      class="bg-successBase text-grayscaleWhite px-3 py-1 text-sm rounded hover:bg-successD100 transition-colors"
      (click)="onSaveChanges()"
    >
      <i class="fa-solid fa-save mr-1"></i>
      Guardar Cambios
    </button>
  </div>
</div>

<lib-tb-table [custom]="coberturasTable">
  <!-- ✅ Header de la tabla de coberturas -->
  <ng-template libTbTemplate="header">
    <tr>
      <th class="text-center w-16">
        <div class="flex items-center justify-center">
          <i class="fa-solid fa-check-square text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Selección</span>
        </div>
      </th>
      <th libTbSortableColumn="cobertura" class="text-left min-w-72">
        <div class="flex items-center">
          <i class="fa-solid fa-shield-alt text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Coberturas</span>
          <lib-tb-sort-icon [custom]="{field:'cobertura'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="porcentajeAsegurado" class="text-center w-24">
        <div class="flex items-center justify-center">
          <i class="fa-solid fa-percentage text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">% Asegurado</span>
          <lib-tb-sort-icon [custom]="{field:'porcentajeAsegurado'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="valorAsegurado" class="text-right w-28">
        <div class="flex items-center justify-end">
          <i class="fa-solid fa-dollar-sign text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Valor Asegurado</span>
          <lib-tb-sort-icon [custom]="{field:'valorAsegurado'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="tasa" class="text-center w-20">
        <div class="flex items-center justify-center">
          <i class="fa-solid fa-chart-line text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Tasa</span>
          <lib-tb-sort-icon [custom]="{field:'tasa'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="fechaInicio" class="text-center w-24">
        <div class="flex items-center justify-center">
          <i class="fa-solid fa-calendar-alt text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Fecha Inicio</span>
          <lib-tb-sort-icon [custom]="{field:'fechaInicio'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="fechaFin" class="text-center w-24">
        <div class="flex items-center justify-center">
          <i class="fa-solid fa-calendar-times text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Fecha Fin</span>
          <lib-tb-sort-icon [custom]="{field:'fechaFin'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="tiempoAdicional" class="text-center w-28">
        <div class="flex items-center justify-center">
          <i class="fa-solid fa-clock text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Tiempo Adicional</span>
          <lib-tb-sort-icon [custom]="{field:'tiempoAdicional'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="fechaVencimiento" class="text-center w-28">
        <div class="flex items-center justify-center">
          <i class="fa-solid fa-calendar-check text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Fecha Vencimiento</span>
          <lib-tb-sort-icon [custom]="{field:'fechaVencimiento'}"></lib-tb-sort-icon>
        </div>
      </th>
      <th libTbSortableColumn="prima" class="text-right w-24">
        <div class="flex items-center justify-end">
          <i class="fa-solid fa-coins text-primaryBase mr-2"></i>
          <span class="lib-tb-body-medium font-medium">Prima</span>
          <lib-tb-sort-icon [custom]="{field:'prima'}"></lib-tb-sort-icon>
        </div>
      </th>
    </tr>
  </ng-template>

  <!-- ✅ Body de la tabla de coberturas -->
  <ng-template libTbTemplate="body" let-cobertura>
    <tr class="coberturas__table-row" [attr.data-qa-id]="'cobertura-row-' + cobertura.id">
      <!-- Columna Selección -->
      <td class="text-center w-16 py-3">
        <div class="flex items-center justify-center">
          <input
            type="checkbox"
            [checked]="cobertura.seleccionado"
            (change)="onCoberturaCheckboxChange(cobertura, $event)"
            class="w-4 h-4 text-primaryBase bg-grayscaleWhite border-grayscaleL300 rounded focus:ring-primaryBase focus:ring-2"
          />
        </div>
      </td>

      <!-- Columna Cobertura -->
      <td class="text-left min-w-72 py-3">
        <span
          class="lib-tb-body-medium text-grayscaleBlack font-medium"
          >{{ cobertura.cobertura }}</span
        >
      </td>

      <!-- Columna % Asegurado -->
      <td class="text-center w-24 py-3">
        <div
          *ngIf="!cobertura.seleccionado"
          class="lib-tb-body-medium text-grayscaleBlack font-medium"
        >
          {{ cobertura.porcentajeAsegurado }}%
        </div>
        <div *ngIf="cobertura.seleccionado" class="flex items-center justify-center">
          <input
            type="number"
            [value]="cobertura.porcentajeAsegurado"
            (input)="onPorcentajeChange(cobertura, $event)"
            class="w-20 text-center lib-tb-body-medium text-grayscaleBlack bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
            min="0"
            max="100"
            step="5"
          />
          <span class="lib-tb-body-medium text-grayscaleBlack ml-2">%</span>
        </div>
      </td>

      <!-- Columna Valor Asegurado -->
      <td class="text-right w-28 py-3">
        <div
          *ngIf="!cobertura.seleccionado"
          class="lib-tb-body-medium text-grayscaleBlack font-semibold"
        >
          ${{ cobertura.valorAsegurado | number:'1.0-0' }}
        </div>
        <input
          *ngIf="cobertura.seleccionado"
          type="number"
          [value]="cobertura.valorAsegurado"
          (input)="onValorAseguradoChange(cobertura, $event)"
          class="w-full text-right lib-tb-body-medium text-grayscaleBlack bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
          min="0"
          step="100000"
        />
      </td>

      <!-- Columna Tasa -->
      <td class="text-center w-20 py-3">
        <div *ngIf="!cobertura.seleccionado" class="lib-tb-body-medium text-grayscaleBlack">
          {{ cobertura.tasa }}%
        </div>
        <div *ngIf="cobertura.seleccionado" class="flex items-center justify-center">
          <input
            type="number"
            [value]="cobertura.tasa"
            (input)="onTasaChange(cobertura, $event)"
            class="w-16 text-center lib-tb-body-medium text-grayscaleBlack bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
            min="0"
            max="100"
            step="0.1"
          />
          <span class="lib-tb-body-medium text-grayscaleBlack ml-2">%</span>
        </div>
      </td>

      <!-- Columna Fecha Inicio -->
      <td class="text-center w-24 py-3">
        <div *ngIf="!cobertura.seleccionado" class="lib-tb-body-medium text-grayscaleD200">
          {{ cobertura.fechaInicio | date:'dd/MM/yy' }}
        </div>
        <input
          *ngIf="cobertura.seleccionado"
          type="date"
          [value]="cobertura.fechaInicio"
          (change)="onFechaInicioChange(cobertura, $event)"
          class="w-full text-center lib-tb-body-medium text-grayscaleD200 bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
        />
      </td>

      <!-- Columna Fecha Fin -->
      <td class="text-center w-24 py-3">
        <div *ngIf="!cobertura.seleccionado" class="lib-tb-body-medium text-grayscaleD200">
          {{ cobertura.fechaFin | date:'dd/MM/yy' }}
        </div>
        <input
          *ngIf="cobertura.seleccionado"
          type="date"
          [value]="cobertura.fechaFin"
          (change)="onFechaFinChange(cobertura, $event)"
          class="w-full text-center lib-tb-body-medium text-grayscaleD200 bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
        />
      </td>

      <!-- Columna Tiempo Adicional -->
      <td class="text-center w-28 py-3">
        <div
          *ngIf="!cobertura.seleccionado"
          class="lib-tb-body-medium text-grayscaleBlack font-medium"
        >
          {{ cobertura.tiempoAdicional }} días
        </div>
        <div *ngIf="cobertura.seleccionado" class="flex items-center justify-center">
          <input
            type="number"
            [value]="cobertura.tiempoAdicional"
            (input)="onTiempoAdicionalChange(cobertura, $event)"
            class="w-20 text-center lib-tb-body-medium text-grayscaleBlack bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
            min="0"
            max="365"
            step="1"
          />
          <span class="lib-tb-body-medium text-grayscaleBlack ml-2">días</span>
        </div>
      </td>

      <!-- Columna Fecha Vencimiento -->
      <td class="text-center w-28 py-3">
        <div *ngIf="!cobertura.seleccionado" class="lib-tb-body-medium text-grayscaleD200">
          {{ cobertura.fechaVencimiento | date:'dd/MM/yy' }}
        </div>
        <input
          *ngIf="cobertura.seleccionado"
          type="date"
          [value]="cobertura.fechaVencimiento"
          (change)="onFechaVencimientoChange(cobertura, $event)"
          class="w-full text-center lib-tb-body-medium text-grayscaleD200 bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
        />
      </td>

      <!-- Columna Prima -->
      <td class="text-right w-24 py-3">
        <div
          *ngIf="!cobertura.seleccionado"
          class="lib-tb-body-medium text-grayscaleBlack font-semibold"
        >
          ${{ cobertura.prima | number:'1.0-0' }}
        </div>
        <input
          *ngIf="cobertura.seleccionado"
          type="number"
          [value]="cobertura.prima"
          (input)="onPrimaChange(cobertura, $event)"
          class="w-full text-right lib-tb-body-medium text-grayscaleBlack bg-grayscaleL400 border border-grayscaleL200 rounded px-3 py-2 focus:outline-none focus:border-primaryBase focus:ring-1 focus:ring-primaryBase"
          min="0"
          step="1000"
        />
      </td>
    </tr>
  </ng-template>
</lib-tb-table>
