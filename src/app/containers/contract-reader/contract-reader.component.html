<!-- ✅ Container principal del contract-reader - Mobile responsive -->
<div class="min-h-screen bg-grayscaleL400">
  <div class="max-w-7xl mx-auto px-2 py-4 sm:px-4 sm:py-8">
    <!-- ✅ Breadcrumb navigation (como settings) -->
    <div class="mb-4 sm:mb-6">
      <lib-tb-breadcrumb [custom]="breadcrumbConfig"></lib-tb-breadcrumb>
    </div>

    <!-- ✅ Header del contract reader -->
    <div class="contract-reader__header text-center mb-6 sm:mb-8">
      <h1 class="lib-tb-h4-bold text-grayscaleBlack mb-2">Análisis de Contratos con IA</h1>
      <p class="lib-tb-body-medium text-grayscaleD200 max-w-3xl mx-auto">
        Suba un contrato en formato PDF, DOC o DOCX y obtenga automáticamente la información
        extraída y sugerencias de pólizas.
      </p>
    </div>

    <!-- ✅ Alertas de estado -->
    <div *ngIf="getStatusAlert()" class="contract-reader__alerts mb-6">
      <lib-tb-alert [custom]="getStatusAlert()!"></lib-tb-alert>
    </div>

    <!-- ✅ Área de carga de archivos - Solo mostrar si está idle -->
    <div
      *ngIf="isIdle"
      class="contract-reader__upload-area bg-grayscaleWhite rounded-lg shadow-sm border border-grayscaleL200 mb-6 p-6"
    >
      <!-- ✅ USANDO TECH-BLOCK-LIB: FileUploadField component -->
      <lib-tb-file-upload-field [custom]="fileUploadConfig"></lib-tb-file-upload-field>
    </div>

    <!-- ✅ Área de procesamiento - Mostrar durante upload y procesamiento -->
    <div
      *ngIf="isProcessing"
      class="contract-reader__processing bg-grayscaleWhite p-6 sm:p-8 rounded-lg shadow-sm border border-grayscaleL200 mb-6"
    >
      <div class="flex flex-col items-center text-center">
        <!-- Spinner de progreso -->
        <div *ngIf="showSpinner" class="mb-6">
          <lib-tb-progress-spinner [custom]="progressSpinner"></lib-tb-progress-spinner>
        </div>

        <!-- Información del archivo -->
        <div class="contract-reader__file-info mb-4">
          <h3 class="lib-tb-h6-bold text-grayscaleBlack mb-2">{{ currentFile.name }}</h3>
          <p class="lib-tb-body-small text-grayscaleD200">{{ fileSize }}</p>
        </div>

        <!-- Barra de progreso -->
        <div class="w-full max-w-md">
          <div class="bg-grayscaleL300 rounded-full h-2 mb-2">
            <div
              class="bg-primaryBase h-2 rounded-full transition-all duration-300"
              [style.width.%]="currentFile.progress"
            ></div>
          </div>
          <p class="lib-tb-body-small text-grayscaleD100 text-center">
            {{ currentFile.progress }}%
          </p>
        </div>
      </div>
    </div>

    <!-- ✅ Resultados del análisis - Solo mostrar si está completado -->
    <div *ngIf="hasResults" class="contract-reader__results space-y-6">
      <!-- Header de resultados con acciones -->
      <div
        class="contract-reader__results-header bg-grayscaleWhite p-4 sm:p-6 rounded-lg shadow-sm border border-grayscaleL200"
      >
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
          <div class="text-center sm:text-left">
            <h2 class="lib-tb-h5-bold text-grayscaleBlack mb-1">Análisis Completado</h2>
            <p class="lib-tb-body-medium text-grayscaleD200">
              {{ currentFile.name }} • Procesado en {{ analysisResults?.processingTime }}s •
              Confianza: {{ analysisResults?.confidence }}%
            </p>
          </div>

          <div class="flex gap-2">
            <lib-tb-button [custom]="btnExportResults"></lib-tb-button>
            <lib-tb-button [custom]="btnUploadNew"></lib-tb-button>
          </div>
        </div>
      </div>

      <!-- Grid de resultados principales -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Información general del contrato -->
        <div
          class="contract-reader__general-info bg-grayscaleWhite p-4 sm:p-6 rounded-lg shadow-sm border border-grayscaleL200"
        >
          <h3 class="lib-tb-h6-bold text-primaryBase mb-4">
            <i class="fal fa-file-contract text-primaryBase mr-2"></i>
            Información General
          </h3>

          <div class="space-y-3">
            <div class="contract-reader__info-item">
              <span class="lib-tb-body-small text-grayscaleD100">Número de Contrato:</span>
              <p class="lib-tb-body-medium text-grayscaleBlack font-semibold">
                {{ analysisResults?.extractedData?.numeroContrato }}
              </p>
            </div>

            <div class="contract-reader__info-item">
              <span class="lib-tb-body-small text-grayscaleD100">Objeto del Contrato:</span>
              <p class="lib-tb-body-medium text-grayscaleBlack">
                {{ analysisResults?.extractedData?.objetoContrato }}
              </p>
            </div>

            <div class="contract-reader__info-item">
              <span class="lib-tb-body-small text-grayscaleD100">Valor del Contrato:</span>
              <p class="lib-tb-body-medium text-grayscaleBlack font-semibold">
                {{ formatCurrency(analysisResults?.extractedData?.valorContrato || 0) }}
              </p>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="contract-reader__info-item">
                <span class="lib-tb-body-small text-grayscaleD100">Fecha Inicio:</span>
                <p class="lib-tb-body-medium text-grayscaleBlack">
                  {{ analysisResults?.extractedData?.fechaInicio | date:'dd/MM/yyyy' }}
                </p>
              </div>
              <div class="contract-reader__info-item">
                <span class="lib-tb-body-small text-grayscaleD100">Fecha Fin:</span>
                <p class="lib-tb-body-medium text-grayscaleBlack">
                  {{ analysisResults?.extractedData?.fechaTerminacion | date:'dd/MM/yyyy' }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Información de las partes -->
        <div
          class="contract-reader__parties-info bg-grayscaleWhite p-4 sm:p-6 rounded-lg shadow-sm border border-grayscaleL200"
        >
          <h3 class="lib-tb-h6-bold text-primaryBase mb-4">
            <i class="fal fa-users text-primaryBase mr-2"></i>
            Partes del Contrato
          </h3>

          <!-- Contratante -->
          <div class="mb-4">
            <h4 class="lib-tb-body-medium text-grayscaleBlack font-semibold mb-2">Contratante</h4>
            <div class="space-y-1">
              <p class="lib-tb-body-small text-grayscaleBlack">
                {{ analysisResults?.extractedData?.contratante?.nombre }}
              </p>
              <p class="lib-tb-body-small text-grayscaleD200">
                NIT: {{ analysisResults?.extractedData?.contratante?.nit }}
              </p>
              <p class="lib-tb-body-small text-grayscaleD200">
                {{ analysisResults?.extractedData?.contratante?.email }}
              </p>
            </div>
          </div>

          <!-- Contratista -->
          <div>
            <h4 class="lib-tb-body-medium text-grayscaleBlack font-semibold mb-2">Contratista</h4>
            <div class="space-y-1">
              <p class="lib-tb-body-small text-grayscaleBlack">
                {{ analysisResults?.extractedData?.contratista?.nombre }}
              </p>
              <p class="lib-tb-body-small text-grayscaleD200">
                NIT: {{ analysisResults?.extractedData?.contratista?.nit }}
              </p>
              <p class="lib-tb-body-small text-grayscaleD200">
                {{ analysisResults?.extractedData?.contratista?.email }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Sugerencias de pólizas -->
      <div
        class="contract-reader__suggestions bg-grayscaleWhite p-4 sm:p-6 rounded-lg shadow-sm border border-grayscaleL200"
      >
        <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
          <h3 class="lib-tb-h6-bold text-primaryBase">
            <i class="fal fa-lightbulb text-primaryBase mr-2"></i>
            Sugerencias de Pólizas
          </h3>

          <lib-tb-button [custom]="btnCreatePolicy"></lib-tb-button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div
            *ngFor="let suggestion of analysisResults?.suggestions"
            class="contract-reader__suggestion-card p-4 border border-grayscaleL200 rounded-lg hover:border-primaryBase transition-colors cursor-pointer"
            (click)="createPolicyFromSuggestion(suggestion)"
          >
            <div class="flex justify-between items-start mb-3">
              <h4 class="lib-tb-body-medium text-grayscaleBlack font-semibold">
                {{ suggestion.tipoPoliza }}
              </h4>
              <div class="flex items-center gap-2">
                <span
                  class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
                  [class]="getPriorityClass(suggestion.prioridad)"
                >
                  {{ suggestion.prioridad }}
                </span>
                <span
                  *ngIf="suggestion.obligatoria"
                  class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-errorBase text-grayscaleWhite"
                >
                  Obligatoria
                </span>
              </div>
            </div>

            <p class="lib-tb-body-small text-grayscaleD200 mb-3">{{ suggestion.descripcion }}</p>

            <div class="flex justify-between items-center">
              <span class="lib-tb-body-medium text-grayscaleBlack font-semibold">
                {{ formatCurrency(suggestion.valorSugerido) }}
                <span
                  *ngIf="suggestion.porcentaje"
                  class="lib-tb-body-small text-grayscaleD200 font-normal"
                >
                  ({{ suggestion.porcentaje }}%)
                </span>
              </span>

              <i class="fal fa-arrow-right text-primaryBase"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Riesgos identificados -->
      <div
        class="contract-reader__risks bg-grayscaleWhite p-4 sm:p-6 rounded-lg shadow-sm border border-grayscaleL200"
      >
        <h3 class="lib-tb-h6-bold text-primaryBase mb-4">
          <i class="fal fa-exclamation-triangle text-primaryBase mr-2"></i>
          Riesgos Identificados
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div
            *ngFor="let riesgo of analysisResults?.extractedData?.riesgosIdentificados"
            class="contract-reader__risk-item p-3 bg-grayscaleL400 rounded border-l-4 border-warningBase"
          >
            <p class="lib-tb-body-small text-grayscaleBlack">{{ riesgo }}</p>
          </div>
        </div>
      </div>

      <!-- Advertencias del análisis -->
      <div
        *ngIf="analysisResults?.warnings?.length"
        class="contract-reader__warnings bg-warningBase p-4 rounded-lg"
      >
        <h4 class="lib-tb-body-medium text-grayscaleBlack font-semibold mb-2">
          <i class="fal fa-info-circle mr-2"></i>
          Advertencias
        </h4>
        <ul class="space-y-1">
          <li
            *ngFor="let warning of analysisResults?.warnings"
            class="lib-tb-body-small text-grayscaleBlack"
          >
            • {{ warning }}
          </li>
        </ul>
      </div>
    </div>

    <!-- ✅ Estado de error -->
    <div *ngIf="hasError" class="contract-reader__error text-center py-12">
      <i class="fal fa-exclamation-triangle text-6xl text-errorBase mb-4"></i>
      <h3 class="lib-tb-h5-bold text-grayscaleBlack mb-2">Error en el Procesamiento</h3>
      <p class="lib-tb-body-medium text-grayscaleD200 mb-6">
        {{ currentFile.errorMessage }}
      </p>
      <lib-tb-button [custom]="btnUploadNew"></lib-tb-button>
    </div>
  </div>
</div>
