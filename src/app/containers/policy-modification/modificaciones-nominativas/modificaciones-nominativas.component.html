<!-- ✅ Pantalla de Modificaciones Nominativas siguiendo lineamientos tech-block-lib exactos -->
<div class="modificaciones-nominativas">
  <!-- ✅ Breadcrumb de navegación -->
  <div class="modificaciones-nominativas__breadcrumb">
    <lib-tb-breadcrumb [custom]="breadcrumbConfig"></lib-tb-breadcrumb>
  </div>

  <!-- ✅ Información contextual de la póliza -->
  <div class="modificaciones-nominativas__context mb-4">
    <div class="bg-grayscaleWhite p-4 rounded-lg shadow-sm border border-grayscaleL200">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <i class="fal fa-edit text-primaryBase text-lg mr-3"></i>
          <div>
            <h2 class="lib-tb-h6-bold text-grayscaleBlack">Modificaciones Nominativas</h2>
            <p class="lib-tb-body-small text-grayscaleD200">
              Póliza: {{ modificationData.numeroPoliza }} | Tipos: {{ tiposModificacionTexto }}
            </p>
          </div>
        </div>

        <!-- ✅ Indicador de modo -->
        <div class="flex items-center">
          <i
            [ngClass]="{
              'fal fa-edit text-successBase': modificationData.modoEdicion,
              'fal fa-eye text-warningBase': !modificationData.modoEdicion
            }"
            class="mr-2"
          ></i>
          <span
            class="lib-tb-body-small font-medium"
            [ngClass]="{
              'text-successBase': modificationData.modoEdicion,
              'text-warningBase': !modificationData.modoEdicion
            }"
          >
            <span *ngIf="modificationData.modoEdicion">
              Datos Editables{{ mostrarCoberturas ? ' + Coberturas' : '' }}
            </span>
            <span *ngIf="!modificationData.modoEdicion">
              Solo Coberturas{{ hayModificacionesValor ? ' (Valores)' : ''






















              }}{{ hayModificacionesVigencia || hayModificacionesCoberturas ? ' (Fechas)' : '' }}
            </span>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ Formulario completo siguiendo patrón de policy-input -->
  <div class="modificaciones-nominativas__form">
    <lib-tb-dynamic-form [custom]="modificacionesForm"></lib-tb-dynamic-form>
  </div>

  <!-- ✅ AGREGADO: Tabla de coberturas (se muestra si hay modificaciones de valor asegurado) -->
  <div *ngIf="mostrarCoberturas" class="modificaciones-nominativas__coberturas mt-6">
    <div class="bg-grayscaleWhite rounded-lg shadow-sm border border-grayscaleL200 p-4 sm:p-6">
      <div class="mb-4">
        <h3 class="lib-tb-h5-bold text-grayscaleBlack mb-2">
          <i class="fal fa-shield-alt text-primaryBase mr-2"></i>
          Coberturas de Cumplimiento
        </h3>
        <p class="lib-tb-body-medium text-grayscaleD200">
          <span
            *ngIf="hayModificacionesValor && (hayModificacionesVigencia || hayModificacionesCoberturas)"
          >
            Modifique los valores y fechas de vigencia de las coberturas seleccionadas
          </span>
          <span
            *ngIf="hayModificacionesValor && !hayModificacionesVigencia && !hayModificacionesCoberturas"
          >
            Modifique los valores de las coberturas seleccionadas
          </span>
          <span
            *ngIf="!hayModificacionesValor && (hayModificacionesVigencia || hayModificacionesCoberturas)"
          >
            Modifique las fechas de vigencia y selección de las coberturas
          </span>
        </p>
      </div>

      <!-- ✅ Tabla personalizada con campos editables -->
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-grayscaleL200">
              <th class="text-center py-3 px-2 w-16">
                <div class="flex items-center justify-center">
                  <i class="fal fa-check-square text-primaryBase mr-1"></i>
                  <span class="lib-tb-body-small font-semibold text-grayscaleBlack">Sel.</span>
                </div>
              </th>
              <th class="text-left py-3 px-4">
                <div class="flex items-center">
                  <i class="fal fa-shield-alt text-primaryBase mr-2"></i>
                  <span class="lib-tb-body-small font-semibold text-grayscaleBlack">Cobertura</span>
                </div>
              </th>
              <th class="text-center py-3 px-4">
                <div class="flex items-center justify-center">
                  <i class="fal fa-percentage text-primaryBase mr-2"></i>
                  <span class="lib-tb-body-small font-semibold text-grayscaleBlack"
                    >% Asegurado</span
                  >
                </div>
              </th>
              <th class="text-center py-3 px-4">
                <div class="flex items-center justify-center">
                  <i class="fal fa-dollar-sign text-primaryBase mr-2"></i>
                  <span class="lib-tb-body-small font-semibold text-grayscaleBlack"
                    >Valor Asegurado</span
                  >
                </div>
              </th>
              <th class="text-center py-3 px-4">
                <div class="flex items-center justify-center">
                  <i class="fal fa-calendar-alt text-primaryBase mr-2"></i>
                  <span class="lib-tb-body-small font-semibold text-grayscaleBlack">Vigencia</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let cobertura of modificationData.coberturas; trackBy: trackByCoberturaId"
              class="border-b border-grayscaleL100 hover:bg-grayscaleL400 transition-colors"
            >
              <!-- Columna Selección -->
              <td class="text-center py-4 px-2">
                <div class="flex items-center justify-center">
                  <input
                    type="checkbox"
                    [checked]="cobertura.seleccionado"
                    (change)="onCoberturaCheckboxChange(cobertura, $event)"
                    class="w-4 h-4 text-primaryBase bg-grayscaleWhite border-grayscaleL300 rounded focus:ring-primaryBase focus:ring-2"
                  />
                </div>
              </td>

              <!-- Columna Cobertura -->
              <td class="text-left py-4 px-4">
                <span class="lib-tb-body-medium text-grayscaleBlack font-medium">
                  {{ cobertura.cobertura }}
                </span>
              </td>

              <!-- Columna % Asegurado (Editable si está seleccionado y hay modificaciones de valor) -->
              <td class="text-center py-4 px-4">
                <div
                  *ngIf="cobertura.seleccionado && hayModificacionesValor; else readOnlyPorcentaje"
                >
                  <input
                    type="number"
                    [value]="cobertura.porcentajeAsegurado"
                    (input)="onPorcentajeChange(cobertura, $event)"
                    min="0"
                    max="100"
                    step="0.1"
                    class="w-20 px-2 py-1 text-center border border-grayscaleL300 rounded focus:outline-none focus:ring-2 focus:ring-primaryBase focus:border-transparent"
                  />
                  <span class="ml-1 text-sm text-grayscaleD200">%</span>
                </div>
                <ng-template #readOnlyPorcentaje>
                  <span class="lib-tb-body-medium text-grayscaleD100">
                    {{ cobertura.porcentajeAsegurado }}%
                  </span>
                </ng-template>
              </td>

              <!-- Columna Valor Asegurado (Editable si está seleccionado y hay modificaciones de valor) -->
              <td class="text-center py-4 px-4">
                <div *ngIf="cobertura.seleccionado && hayModificacionesValor; else readOnlyValor">
                  <input
                    type="text"
                    [value]="formatCurrency(cobertura.valorAsegurado)"
                    (input)="onValorAseguradoChange(cobertura, $event)"
                    class="w-32 px-2 py-1 text-center border border-grayscaleL300 rounded focus:outline-none focus:ring-2 focus:ring-primaryBase focus:border-transparent"
                  />
                </div>
                <ng-template #readOnlyValor>
                  <span class="lib-tb-body-medium text-grayscaleD100">
                    {{ formatCurrency(cobertura.valorAsegurado) }}
                  </span>
                </ng-template>
              </td>

              <!-- Columna Vigencia (Editable si hay modificaciones de vigencia y está seleccionado) -->
              <td class="text-center py-4 px-4">
                <div
                  *ngIf="cobertura.seleccionado && hayModificacionesVigencia; else readOnlyVigencia"
                  class="text-sm space-y-2"
                >
                  <!-- Fecha de inicio editable -->
                  <div>
                    <label class="lib-tb-body-small text-grayscaleD200 block mb-1">Inicio</label>
                    <input
                      type="date"
                      [value]="cobertura.fechaInicio"
                      (input)="onFechaInicioChange(cobertura, $event)"
                      class="w-full px-2 py-1 text-center border border-grayscaleL300 rounded focus:outline-none focus:ring-2 focus:ring-primaryBase focus:border-transparent text-xs"
                    />
                  </div>
                  <!-- Fecha de vencimiento editable -->
                  <div>
                    <label class="lib-tb-body-small text-grayscaleD200 block mb-1">Fin</label>
                    <input
                      type="date"
                      [value]="cobertura.fechaVencimiento"
                      (input)="onFechaVencimientoChange(cobertura, $event)"
                      class="w-full px-2 py-1 text-center border border-grayscaleL300 rounded focus:outline-none focus:ring-2 focus:ring-primaryBase focus:border-transparent text-xs"
                    />
                  </div>
                </div>
                <ng-template #readOnlyVigencia>
                  <div class="text-sm">
                    <div class="lib-tb-body-small text-grayscaleBlack">
                      {{ cobertura.fechaInicio }}
                    </div>
                    <div class="lib-tb-body-small text-grayscaleD200">
                      {{ cobertura.fechaVencimiento }}
                    </div>
                  </div>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ✅ Acciones principales siguiendo patrón de stepper -->
  <div class="modificaciones-nominativas__actions mt-6">
    <div class="bg-grayscaleWhite p-6 rounded-lg shadow-sm border border-grayscaleL200">
      <div class="flex flex-col sm:flex-row gap-4 justify-between">
        <!-- ✅ Navegación anterior (izquierda) -->
        <div class="flex gap-3">
          <lib-tb-button [custom]="btnAnterior"></lib-tb-button>
        </div>

        <!-- ✅ Acciones principales (derecha) -->
        <div class="flex flex-col sm:flex-row gap-3">
          <lib-tb-button [custom]="btnCancelar"></lib-tb-button>
          <lib-tb-button [custom]="btnGuardarCambios"></lib-tb-button>
        </div>
      </div>

      <!-- ✅ Información sobre el modo de edición -->
      <div class="mt-4 pt-4 border-t border-grayscaleL200">
        <div class="flex items-center">
          <i
            [ngClass]="{
              'fal fa-edit text-successBase': modificationData.modoEdicion,
              'fal fa-info-circle text-infoBase': !modificationData.modoEdicion
            }"
            class="mr-2"
          ></i>
          <p class="lib-tb-body-small text-grayscaleD200">
            <span *ngIf="modificationData.modoEdicion">
              Los campos de datos nominativos están habilitados para edición
              <span *ngIf="mostrarCoberturas && hayModificacionesValor"
                >, así como valores de coberturas</span
              >
              <span
                *ngIf="mostrarCoberturas && (hayModificacionesVigencia || hayModificacionesCoberturas)"
                >, así como fechas de vigencia y selección de coberturas</span
              >.
            </span>
            <span *ngIf="!modificationData.modoEdicion">
              Solo están habilitadas las
              <span *ngIf="hayModificacionesValor">modificaciones de valores</span>
              <span
                *ngIf="hayModificacionesValor && (hayModificacionesVigencia || hayModificacionesCoberturas)"
              >
                y
              </span>
              <span *ngIf="hayModificacionesVigencia || hayModificacionesCoberturas"
                >fechas de vigencia y selección</span
              >
              de las coberturas.
            </span>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
